@startuml ThesisManagementAPI-ClassDiagram

title Thesis Management API - Class Diagram

package "Entities" {
    class UserDataAccessModel {
        + Guid Id
        + string FirstName
        + string LastName
        + string Email
        + string PasswordHash
        + ICollection<UserRoleDataAccessModel> UserRoles
        + ICollection<UserTopicDataAccessModel> UserTopics
    }

    class RoleDataAccessModel {
        + Guid Id
        + string Name
        + ICollection<UserRoleDataAccessModel> UserRoles
    }

    class UserRoleDataAccessModel {
        + Guid UserId
        + Guid RoleId
    }

    class ThesisDataAccessModel {
        + Guid Id
        + string Title
        + Guid StatusId
        + Guid BillingStatusId
        + Guid OwnerId
        + Guid TutorId
        + Guid? SecondSupervisorId
        + Guid? TopicId
    }

    class TopicDataAccessModel {
        + Guid Id
        + string Title
        + string Description
        + bool IsActive
        + ICollection<UserTopicDataAccessModel> UserTopics
    }

    class UserTopicDataAccessModel {
        + Guid UserId
        + Guid TopicId
    }

    class BaseEntity {
        + Guid Id
        + DateTime CreatedAt
        + DateTime UpdatedAt
    }

    UserDataAccessModel --|> BaseEntity
    RoleDataAccessModel --|> BaseEntity
    ThesisDataAccessModel --|> BaseEntity
    TopicDataAccessModel --|> BaseEntity

    UserRoleDataAccessModel --> UserDataAccessModel
    UserRoleDataAccessModel --> RoleDataAccessModel
    UserTopicDataAccessModel --> UserDataAccessModel
    UserTopicDataAccessModel --> TopicDataAccessModel
    ThesisDataAccessModel --> UserDataAccessModel : "Owner"
    ThesisDataAccessModel --> UserDataAccessModel : "Tutor"
    ThesisDataAccessModel --> UserDataAccessModel : "SecondSupervisor"
    ThesisDataAccessModel --> TopicDataAccessModel
}

package "DataAccess" {
    class ThesisDbContext {
        + DbSet<UserDataAccessModel> Users
        + DbSet<RoleDataAccessModel> Roles
        + DbSet<UserRoleDataAccessModel> UserRoles
        + DbSet<ThesisDataAccessModel> Theses
        + DbSet<TopicDataAccessModel> Topics
        + DbSet<UserTopicDataAccessModel> UserTopics
    }
}

package "Services" {
    interface IUserBusinessLogicService {
        + Task<PaginatedResult<...>> GetAllAsync(...)
        + Task<UserBusinessLogicModel> GetByIdAsync(Guid id)
        + Task<UserBusinessLogicModel> GetByEmailAsync(string email)
        + Task<UserBusinessLogicModel> CreateUserAsync(...)
        + Task<bool> VerifyPasswordAsync(string email, string password)
        + Task<bool> UserHasRoleAsync(Guid userId, string roleName)
        + Task<PaginatedResponse<TutorProfileResponse>> GetTutorsAsync(Guid? topicId, string? topicName, int page, int pageSize)
        + Task<TutorProfileResponse> GetTutorByIdAsync(Guid id)
    }

    interface IThesisService {
        + Task<PaginatedResult<...>> GetAllAsync(int page, int pageSize, Guid userId, List<string> userRoles)
        + Task<ThesisBusinessLogicModel> GetByIdAsync(Guid id)
        + Task<ThesisBusinessLogicModel> CreateThesisAsync(...)
        + Task<ThesisBusinessLogicModel> UpdateThesisAsync(...)
        + Task<bool> DeleteThesisAsync(Guid id)
    }

    interface ITopicService {
        + Task<PaginatedResult<...>> GetAllAsync(...)
        + Task<TopicBusinessLogicModel> GetByIdAsync(Guid id)
        + Task<List<TopicBusinessLogicModel>> SearchAsync(string query, ...)
        + Task<TopicBusinessLogicModel> CreateTopicAsync(...)
        + Task<TopicBusinessLogicModel> UpdateTopicAsync(...)
        + Task<bool> DeleteTopicAsync(Guid id)
    }

    class UserBusinessLogicService
    class ThesisService
    class TopicService

    UserBusinessLogicService ..|> IUserBusinessLogicService
    ThesisService ..|> IThesisService
    TopicService ..|> ITopicService
}

package "Controllers" {
    class AuthController {
        + Task<IActionResult> Login(LoginRequest request)
    }
    class UserController {
        + Task<IActionResult> GetAll(...)
        + Task<IActionResult> Create(CreateUserRequest request)
    }
    class TutorController {
        + Task<IActionResult> GetTutors(Guid? topicId, string? topicName, int page, int pageSize)
        + Task<IActionResult> GetTutorById(Guid id)
    }
    class TopicController {
        + Task<IActionResult> GetAll(...)
        + Task<IActionResult> Search(...)
        + Task<IActionResult> GetById(Guid id)
        + Task<IActionResult> Create(CreateTopicRequest request)
        + Task<IActionResult> Update(Guid id, UpdateTopicRequest request)
        + Task<IActionResult> Delete(Guid id)
    }
    class ThesisController {
        + Task<IActionResult> GetAll(int page, int pageSize)
        + Task<IActionResult> GetById(Guid id)
        + Task<IActionResult> Create(CreateThesisRequest request)
        + Task<IActionResult> Update(Guid id, UpdateThesisRequest request)
        + Task<IActionResult> Delete(Guid id)
    }
}

package "Models" {
    class LoginRequest
    class LoginResponse
    class CreateUserRequest
    class UserResponse
    class PaginatedResponse<T>
    class TutorProfileResponse
    class TopicResponse
    class CreateTopicRequest
    class UpdateTopicRequest
    class CreateThesisRequest
    class UpdateThesisRequest
}

AuthController --> IUserBusinessLogicService
UserController --> IUserBusinessLogicService
TutorController --> IUserBusinessLogicService
TopicController --> ITopicService
ThesisController --> IThesisService

UserBusinessLogicService --> ThesisDbContext
ThesisService --> ThesisDbContext
TopicService --> ThesisDbContext

@enduml
